
> backend@1.0.0 test
> cross-env NODE_ENV=test node --experimental-vm-modules node_modules/jest/bin/jest.js --testTimeout=120000 tests/volunteer_lifecycle.test.js

(node:18328) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.error
    Failed to send welcome OTP email: Error: connect ECONNREFUSED 127.0.0.1:587
        at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
      errno: -4078,
      code: 'ESOCKET',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 587,
      command: 'CONN'
    }

    [0m [90m  95 |[39m                 })[33m;[39m
     [90m  96 |[39m             } [36mcatch[39m (err) {
    [31m[1m>[22m[39m[90m  97 |[39m                 console[33m.[39merror([32m"Failed to send welcome OTP email:"[39m[33m,[39m err)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m  98 |[39m                 [90m// We still proceed, user can request new OTP on login[39m
     [90m  99 |[39m             }
     [90m 100 |[39m[0m

      at signupUser (controllers/auth.controller.js:97:25)

  console.error
    Failed to send welcome OTP email: Error: connect ECONNREFUSED 127.0.0.1:587
        at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
      errno: -4078,
      code: 'ESOCKET',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 587,
      command: 'CONN'
    }

    [0m [90m  95 |[39m                 })[33m;[39m
     [90m  96 |[39m             } [36mcatch[39m (err) {
    [31m[1m>[22m[39m[90m  97 |[39m                 console[33m.[39merror([32m"Failed to send welcome OTP email:"[39m[33m,[39m err)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m  98 |[39m                 [90m// We still proceed, user can request new OTP on login[39m
     [90m  99 |[39m             }
     [90m 100 |[39m[0m

      at signupUser (controllers/auth.controller.js:97:25)

  console.error
    Failed to send welcome OTP email: Error: connect ECONNREFUSED 127.0.0.1:587
        at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
      errno: -4078,
      code: 'ESOCKET',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 587,
      command: 'CONN'
    }

    [0m [90m  95 |[39m                 })[33m;[39m
     [90m  96 |[39m             } [36mcatch[39m (err) {
    [31m[1m>[22m[39m[90m  97 |[39m                 console[33m.[39merror([32m"Failed to send welcome OTP email:"[39m[33m,[39m err)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m  98 |[39m                 [90m// We still proceed, user can request new OTP on login[39m
     [90m  99 |[39m             }
     [90m 100 |[39m[0m

      at signupUser (controllers/auth.controller.js:97:25)

  console.error
    Failed to send welcome OTP email: Error: connect ECONNREFUSED 127.0.0.1:587
        at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
      errno: -4078,
      code: 'ESOCKET',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 587,
      command: 'CONN'
    }

    [0m [90m  95 |[39m                 })[33m;[39m
     [90m  96 |[39m             } [36mcatch[39m (err) {
    [31m[1m>[22m[39m[90m  97 |[39m                 console[33m.[39merror([32m"Failed to send welcome OTP email:"[39m[33m,[39m err)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m  98 |[39m                 [90m// We still proceed, user can request new OTP on login[39m
     [90m  99 |[39m             }
     [90m 100 |[39m[0m

      at signupUser (controllers/auth.controller.js:97:25)

  console.error
    Failed to send welcome OTP email: Error: connect ECONNREFUSED 127.0.0.1:587
        at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
      errno: -4078,
      code: 'ESOCKET',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 587,
      command: 'CONN'
    }

    [0m [90m  95 |[39m                 })[33m;[39m
     [90m  96 |[39m             } [36mcatch[39m (err) {
    [31m[1m>[22m[39m[90m  97 |[39m                 console[33m.[39merror([32m"Failed to send welcome OTP email:"[39m[33m,[39m err)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m  98 |[39m                 [90m// We still proceed, user can request new OTP on login[39m
     [90m  99 |[39m             }
     [90m 100 |[39m[0m

      at signupUser (controllers/auth.controller.js:97:25)

FAIL tests/volunteer_lifecycle.test.js (9.975 s)
  Volunteer Lifecycle Integration Tests
    Mission Claim Integrity
      Ã— should allow a volunteer to accept a mission and update status (525 ms)
      Ã— should prevent another volunteer from claiming the same mission (279 ms)
    Progressive State Machine
      Ã— should support the full happy path lifecycle (286 ms)
      Ã— should prevent jumping to delivered via status endpoint (190 ms)
    Automatic Impact Calculation
      Ã— should increment volunteer stats upon delivery confirmation (179 ms)

  â— Volunteer Lifecycle Integration Tests â€º Mission Claim Integrity â€º should allow a volunteer to accept a mission and update status

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 45 |[39m             organization[33m:[39m [32m'Test Org'[39m
     [90m 46 |[39m         })[33m;[39m
    [31m[1m>[22m[39m[90m 47 |[39m         donorToken [33m=[39m donorRes[33m.[39mheaders[[32m'set-cookie'[39m][[35m0[39m][33m;[39m
     [90m    |[39m                                                    [31m[1m^[22m[39m
     [90m 48 |[39m         [36mconst[39m donor [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mfindOne({ email[33m:[39m [32m'donor@test.com'[39m })[33m;[39m
     [90m 49 |[39m         donorId [33m=[39m donor[33m.[39m_id[33m;[39m
     [90m 50 |[39m[0m

      at Object.<anonymous> (tests/volunteer_lifecycle.test.js:47:52)

  â— Volunteer Lifecycle Integration Tests â€º Mission Claim Integrity â€º should prevent another volunteer from claiming the same mission

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 45 |[39m             organization[33m:[39m [32m'Test Org'[39m
     [90m 46 |[39m         })[33m;[39m
    [31m[1m>[22m[39m[90m 47 |[39m         donorToken [33m=[39m donorRes[33m.[39mheaders[[32m'set-cookie'[39m][[35m0[39m][33m;[39m
     [90m    |[39m                                                    [31m[1m^[22m[39m
     [90m 48 |[39m         [36mconst[39m donor [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mfindOne({ email[33m:[39m [32m'donor@test.com'[39m })[33m;[39m
     [90m 49 |[39m         donorId [33m=[39m donor[33m.[39m_id[33m;[39m
     [90m 50 |[39m[0m

      at Object.<anonymous> (tests/volunteer_lifecycle.test.js:47:52)

  â— Volunteer Lifecycle Integration Tests â€º Progressive State Machine â€º should support the full happy path lifecycle

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 45 |[39m             organization[33m:[39m [32m'Test Org'[39m
     [90m 46 |[39m         })[33m;[39m
    [31m[1m>[22m[39m[90m 47 |[39m         donorToken [33m=[39m donorRes[33m.[39mheaders[[32m'set-cookie'[39m][[35m0[39m][33m;[39m
     [90m    |[39m                                                    [31m[1m^[22m[39m
     [90m 48 |[39m         [36mconst[39m donor [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mfindOne({ email[33m:[39m [32m'donor@test.com'[39m })[33m;[39m
     [90m 49 |[39m         donorId [33m=[39m donor[33m.[39m_id[33m;[39m
     [90m 50 |[39m[0m

      at Object.<anonymous> (tests/volunteer_lifecycle.test.js:47:52)

  â— Volunteer Lifecycle Integration Tests â€º Progressive State Machine â€º should prevent jumping to delivered via status endpoint

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 45 |[39m             organization[33m:[39m [32m'Test Org'[39m
     [90m 46 |[39m         })[33m;[39m
    [31m[1m>[22m[39m[90m 47 |[39m         donorToken [33m=[39m donorRes[33m.[39mheaders[[32m'set-cookie'[39m][[35m0[39m][33m;[39m
     [90m    |[39m                                                    [31m[1m^[22m[39m
     [90m 48 |[39m         [36mconst[39m donor [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mfindOne({ email[33m:[39m [32m'donor@test.com'[39m })[33m;[39m
     [90m 49 |[39m         donorId [33m=[39m donor[33m.[39m_id[33m;[39m
     [90m 50 |[39m[0m

      at Object.<anonymous> (tests/volunteer_lifecycle.test.js:47:52)

  â— Volunteer Lifecycle Integration Tests â€º Automatic Impact Calculation â€º should increment volunteer stats upon delivery confirmation

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 45 |[39m             organization[33m:[39m [32m'Test Org'[39m
     [90m 46 |[39m         })[33m;[39m
    [31m[1m>[22m[39m[90m 47 |[39m         donorToken [33m=[39m donorRes[33m.[39mheaders[[32m'set-cookie'[39m][[35m0[39m][33m;[39m
     [90m    |[39m                                                    [31m[1m^[22m[39m
     [90m 48 |[39m         [36mconst[39m donor [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mfindOne({ email[33m:[39m [32m'donor@test.com'[39m })[33m;[39m
     [90m 49 |[39m         donorId [33m=[39m donor[33m.[39m_id[33m;[39m
     [90m 50 |[39m[0m

      at Object.<anonymous> (tests/volunteer_lifecycle.test.js:47:52)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 5 total
Snapshots:   0 total
Time:        10.15 s, estimated 15 s
Ran all test suites matching tests/volunteer_lifecycle.test.js.
